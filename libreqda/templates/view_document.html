{% extends "base.html" %}
{% load i18n %}

{% block head %}
  {{ block.super }}
{% endblock head %}

{% block topbar_extra %}
{% endblock topbar_extra %}

{% block body %}
  <div id="documents-menu" class="menu left">
    {% include "view_document_documents_tab.html" %}
  </div>

  <div class="row-fluid">
    <div class="span10 offset1">
      <div class="toolbar move-up">
        <a class="btn left-group-button pull-right"><i class="icon-tags"></i> {% trans "Categorías" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-file"></i> {% trans "Informes" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-search"></i> {% trans "Consultas" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-filter"></i> {% trans "Filtros" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-comment"></i> {% trans "Anotaciones" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-book"></i> {% trans "Códigos" %}</a>
        <a class="btn left-group-button pull-right"><i class="icon-bookmark"></i> {% trans "Citas" %}</a>
      </div>
    </div>
  </div>
  
  <div class="document-container white-background with-border row-fluid">
    <div class="span9 document-text">
      <h3>{{ document.name }}</h3>
      <div id="doc-text-area">
        {{ document.document.text|linebreaks }}
      </div>
    </div>
    <div class="span3 document-citations">
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function() {
        setTimeout(function() {
          $('#documents-menu').css('left','-430px');
        }, 250);
        
        Annotator.Plugin.StoreLogger = function (element) {
          return {
            pluginInit: function () {
              this.annotator
                .subscribe("annotationCreated", function (annotation) {                  
                  console.info("The annotation: %o has just been created!", annotation)
                });
              }
          }
        };
        
        $('#doc-text-area').annotator()
          .annotator('addPlugin', 'StoreLogger')
          .annotator('addPlugin', 'Store', {
            prefix: '',
            urls: {
              create:  '{% url annotations_create pid=project.id did=document.id %}',
              read:    '{% url annotations_read pid=project.id did=document.id %}:id',
              update:  '/update/:id',
              destroy: '/destroy/:id',
              search:  '/search/'
            },
            annotationData: {
              // Extra parameters
            },
          });
        
    });
  </script>
{% endblock %}